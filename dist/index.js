#! /usr/bin/env node
import e from"inquirer";import{createSpinner as t}from"nanospinner";import{downloadTemplate as a}from"giget";import{readFile as o,writeFile as i}from"fs/promises";let r=(e=2e3)=>new Promise(t=>setTimeout(t,e));console.clear(),console.log("\x1b[1m\x1b[34m%s\x1b[0m","create-discord-bot");let n=["awesome-bot","wicked-bot","a-nice-bot","cool-bot","a-bot","general-purpose-bot","the-bot","sbot"],s=[{message:"Where would you like to create the discord bot ?",type:"input",name:"directoryPath",default:"./",filter:e=>e.endsWith("/")?e.slice(0,-1):e},{message:"What is the name of your bot ?",type:"input",name:"botName",default:n[Math.floor(Math.random()*n.length)]},{message:"What language do you want to use ?",name:"language",type:"list",choices:["Typescript","Javascript"],filter:e=>e.toLowerCase()},{message:"What type of logging do you want to use ?",name:"logger",type:"list",choices:["Default","Pino"],filter:e=>e.toLowerCase()},{message:"Do you want to enable ESLint ?",type:"confirm",name:"eslint"},{message:"Do you want to enable Prettier ?",type:"confirm",name:"prettier"}];e.prompt(s).then(async e=>{console.clear();let n=t("Setting up your project...");n.start(),r();try{n.update({text:"Downloading Main Files"}),await a(`github:flzyy/create-discord-bot/templates/${e.language}/${e.logger}`,{dir:e.directoryPath,force:!0});let s=await o(`${e.directoryPath}/package.json`);if(s){let l=JSON.parse(s.toString());l.name=e.botName,await i(`${e.directoryPath}/package.json`,JSON.stringify(l,null,"	"))}if(!0===e.eslint){if(n.update({text:"Setting up ESLint"}),await a(`github:flzyy/create-discord-bot/templates/eslint/${e.language}`,{dir:e.directoryPath,force:!0}),"typescript"===e.language){let c=await o(`${e.directoryPath}/package.json`);if(c){let p=JSON.parse(c.toString());p.devDependencies["@typescript-eslint/eslint-plugin"]="^5.46.1",p.devDependencies["@typescript-eslint/parser"]="^5.46.1",p.devDependencies.eslint="^8.29.0",await i(`${e.directoryPath}/package.json`,JSON.stringify(p,null,"	"))}}else{let d=await o(`${e.directoryPath}/package.json`);if(d){let g=JSON.parse(d.toString());g.devDependencies.eslint="^8.29.0",await i(`${e.directoryPath}/package.json`,JSON.stringify(g,null,"	"))}}}if(!0===e.prettier){if(n.update({text:"Setting up Prettier"}),await a("github:flzyy/create-discord-bot/templates/prettier",{dir:e.directoryPath,force:!0}),!0===e.eslint){let m=await o(`${e.directoryPath}/.eslintrc.json`);if(m){let y=JSON.parse(m.toString());y.extends.push("prettier"),await i(`${e.directoryPath}/.eslintrc.json`,JSON.stringify(y,null,"	"))}}let u=await o(`${e.directoryPath}/package.json`);if(u){let b=JSON.parse(u.toString());b.devDependencies.prettier="^2.8.1",await i(`${e.directoryPath}/package.json`,JSON.stringify(b,null,"	"))}}await i(`${e.directoryPath}/.env`,'DISCORD_TOKEN="YOUR TOKEN HERE"\nCLIENT_ID="YOUR CLIENT ID HERE"'),n.success({text:"Done!"}),console.log("\x1b[1m\x1b[34m%s\x1b[0m","Next steps:"),console.log("\x1b[37m","1. cd asd","\x1b[90m (Puts your terminal into the folder)"),console.log("\x1b[37m","2. npm install","\x1b[90m (Installs all dependencies required)"),console.log("\x1b[37m","3. Fill out .env file"),console.log("\x1b[37m","4. npm start","\x1b[90m (Starts the bot)")}catch(f){n.error({text:`\x1b[90m An error has occured: [31m asdsasd`})}}).catch(e=>{console.error("\x1b[31m",e)});